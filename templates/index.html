<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamburg Unfallkarte</title>

    <!-- CSS laden -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet" />

    <!-- JavaScript-Bibliotheken -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <div id="top-bar">        <div class="button-group">
            <button class="nav-button" onclick="toggleFiltersMenu()"><h3>Filter</h3></button>
            <button class="nav-button" onclick="toggleLegendMenu()"><h3>Legende</h3></button>
            <button class="nav-button" onclick="toggleStatsPanel()"><h3>Stats</h3></button>
            <button class="nav-button" id="theme-toggle" onclick="toggleTheme()"><h3>Standard</h3></button>
            <button class="nav-button" id="light-dark-toggle" onclick="toggleLightDarkMode()"><h3>Dark Mode</h3></button>
            <button class="nav-button" id="mode-toggle" onclick="toggleModeChange()"><h3>Punkte</h3></button>
            <select id="district-select" class="nav-button" onchange="flyToDistrict()">
                <option value="">W√§hle ein Bezirk</option>
                <optgroup label="Eimsb√ºttel">
                    <option value="Eimsb√ºttel-Schanzenviertel">Schanzenviertel</option>
                    <option value="Eimsb√ºttel-Hoheluft-West">Hoheluft-West</option>
                    <option value="Eimsb√ºttel-Eppendorf">Eppendorf</option>
                </optgroup>
                <optgroup label="Altona">
                    <option value="Altona-Ottensen">Ottensen</option>
                    <option value="Altona-Altona-Altstadt">Altona-Altstadt</option>
                    <option value="Altona-Bahrenfeld">Bahrenfeld</option>                </optgroup>
                <optgroup label="Hamburg-Mitte">
                    <option value="Hamburg-Mitte-St. Pauli">St. Pauli</option>
                    <option value="Hamburg-Mitte-HafenCity">HafenCity</option>
                    <option value="Hamburg-Mitte-Altstadt">Altstadt</option>
                </optgroup>
                <optgroup label="Hamburg-Nord">
                    <option value="Hamburg-Nord-Winterhude">Winterhude</option>
                    <option value="Hamburg-Nord-Barmbek">Barmbek</option>
                    <option value="Hamburg-Nord-Fuhlsb√ºttel">Fuhlsb√ºttel</option>
                </optgroup>
                <optgroup label="Wandsbek">
                    <option value="Wandsbek-Rahlstedt">Rahlstedt</option>
                    <option value="Wandsbek-Wandsbek">Wandsbek</option>
                    <option value="Wandsbek-Bramfeld">Bramfeld</option>
                </optgroup>
                <optgroup label="Bergedorf">
                    <option value="Bergedorf-Bergedorf">Bergedorf</option>
                    <option value="Bergedorf-Billstedt">Billstedt</option>
                    <option value="Bergedorf-Lohbr√ºgge">Lohbr√ºgge</option>
                </optgroup>
                <optgroup label="Harburg">
                    <option value="Harburg-Harburg">Harburg</option>
                    <option value="Harburg-Neugraben-Fischbek">Neugraben-Fischbek</option>
                    <option value="Harburg-Finkenwerder">Finkenwerder</option>
                </optgroup>
            </select>
        </div>
        <div class="title-container">
            <h1 class="title-right">Unf√§lle</h1>
            <a href="https://www.uni-hamburg.de"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/UHH_Universit√§t_Hamburg_Logo.svg/600px-UHH_Universit√§t_Hamburg_Logo.svg.png" alt="Universit√§t Hamburg Logo" class="uhh-logo"></a>
        </div>
    </div>

    <!-- Map Container -->
    <div id="map-container">
        <div id="map"></div>
        <div id="sidebar-toggle" onclick="toggleSidebar()"></div>
    </div>

    <!-- Filters Menu -->
    <div id="filters-menu" class="slide-menu">
        <div class="menu-header">
            <h2>Filter</h2>
            <button class="close-btn" onclick="toggleFiltersMenu()">‚úï</button>
        </div>
        <form id="filter-form" style="padding: 20px;">
            <label for="filter-start-date" style="display: block; margin-bottom: 5px; font-weight: bold;">Start Date:</label>
            <input type="date" id="filter-start-date" name="filter-start-date" style="width: calc(100% - 22px); padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">

            <label for="filter-end-date" style="display: block; margin-bottom: 5px; font-weight: bold;">End Date:</label>
            <input type="date" id="filter-end-date" name="filter-end-date" style="width: calc(100% - 22px); padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">
            <label>
                <input type="checkbox" name="type" value="UNFALL" checked> Unf√§lle
            </label>
            <label>
                <input type="checkbox" name="type" value="AuthorityOperation" checked> Beh√∂rdliche Eins√§tze
            </label>
        </form>
    </div>

    <!-- Legend Menu -->
    <div id="legend-menu" class="slide-menu">
        <div class="menu-header">
            <h2>Legende</h2>
            <button class="close-btn" onclick="toggleLegendMenu()">‚úï</button>
        </div>
        <div style="padding: 20px;">
            <h4>Date Filter:</h4>
            <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">
                Use the 'Start Date' and 'End Date' selectors in the 'Filters' menu to display events that occurred within a specific time period.
            </p>

            <hr style="margin: 20px 0;">

            <h4>Marker Appearance:</h4>
            <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">
                Markers change color based on event type and age. The <strong>3 newest events</strong> of any type have a blue border highlight.
            </p>

            <!-- Accident Legend -->
            <h5>Unf√§lle (Accidents)</h5>
            <ul style="list-style-type: none; padding-left: 0;">
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-color: rgb(0, 255, 0); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>Today / Future:</strong> Bright Green</div>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-image: linear-gradient(to right, rgb(0, 255, 0), rgb(255, 255, 0)); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>Up to 1 Week Old:</strong> Green to Yellow</div>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-image: linear-gradient(to right, rgb(255, 255, 0), rgb(255, 0, 0)); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>1 to 2 Weeks Old:</strong> Yellow to Red</div>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-image: linear-gradient(to right, rgb(255, 0, 0), rgb(128, 128, 128)); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>2 Weeks to 1 Month Old:</strong> Red to Grey</div>
                </li>
            </ul>

            <!-- Authority Operation Legend -->
            <h5>Beh√∂rdliche Eins√§tze (Authority Operations)</h5>
            <ul style="list-style-type: none; padding-left: 0;">
                 <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-color: rgb(0, 191, 255); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>Today / Future:</strong> Bright Blue</div>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-image: linear-gradient(to right, rgb(0, 191, 255), rgb(150, 0, 255)); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>Up to 1 Week Old:</strong> Blue to Purple</div>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-image: linear-gradient(to right, rgb(150, 0, 255), rgb(255, 0, 255)); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>1 to 2 Weeks Old:</strong> Purple to Magenta</div>
                </li>
                 <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-image: linear-gradient(to right, rgb(255, 0, 255), rgb(128, 128, 128)); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>2 Weeks to 1 Month Old:</strong> Magenta to Grey</div>
                </li>
            </ul>
            
            <hr style="margin: 20px 0;">
            <ul style="list-style-type: none; padding-left: 0;">
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span style="display: inline-block; width: 15px; height: 15px; border-radius: 50%; background-color: rgb(200, 200, 200); border: 1px solid #ccc; margin-right: 10px;"></span>
                    <div><strong>Older than 1 Month:</strong> Light Grey (Opacity: 0.5)</div>
                </li>
            </ul>
        </div>
    </div>    <!-- Stats Panel -->
    <div id="stats-panel" class="slide-menu stats-panel">
        <div class="menu-header">
            <h2>Live Analytics</h2>
            <button class="close-btn" onclick="toggleStatsPanel()">‚úï</button>
        </div>
        <div class="stats-content">
            <div class="stats-section">
                <h3>Live Status</h3>
                <div class="stat-cards">
                    <div class="stat-card live">
                        <div class="stat-value" id="live-new-events">0</div>
                        <div class="stat-label">Neue Events (1h)</div>
                        <div class="stat-trend" id="live-trend">‚Üó</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-visible">0</div>
                        <div class="stat-label">Sichtbare Events</div>
                    </div>                    <div class="stat-card">
                        <div class="stat-value" id="hotspot-count" style="cursor: pointer; color: #4c51bf;" onclick="toggleHotspotView()" title="Click to highlight hotspots">0</div>
                        <div class="stat-label">Hotspots erkannt</div>
                    </div>
                </div>
            </div>
            <div class="stats-section">
                <h3>Zeitbasierte Analyse</h3>
                <div class="stat-cards">
                    <div class="stat-card">
                        <div class="stat-value" id="today-events">0</div>
                        <div class="stat-label">Heute</div>
                        <div class="stat-trend" id="today-trend">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="week-events">0</div>
                        <div class="stat-label">Diese Woche</div>
                        <div class="stat-trend" id="week-trend">‚Üó</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="month-events">0</div>
                        <div class="stat-label">Dieser Monat</div>
                        <div class="stat-trend" id="month-trend">-</div>
                    </div>
                </div>
            </div>
            <div class="stats-section">
                <h3>Event-Typen</h3>
                <div class="distribution-chart" id="event-type-chart">
                    <div class="chart-item">
                        <div class="chart-bar" data-type="UNFALL">
                            <div class="bar-fill" style="width: 0%; background: #ff4757;"></div>
                        </div>
                        <div class="chart-label">Unf√§lle (<span id="accident-count">0</span>)</div>
                    </div>
                    <div class="chart-item">
                        <div class="chart-bar" data-type="AuthorityOperation">
                            <div class="bar-fill" style="width: 0%; background: #3742fa;"></div>
                        </div>
                        <div class="chart-label">Beh√∂rdliche Eins√§tze (<span id="authority-count">0</span>)</div>
                    </div>
                </div>
            </div>
            <div class="stats-section">
                <h3>Advanced Analytics</h3>
                <div class="advanced-stats">
                    <div class="advanced-stat">
                        <span class="stat-icon">‚ö°</span>
                        <div class="stat-info">
                            <div class="stat-title">Ereignisrate</div>
                            <div class="stat-desc" id="event-rate">0 Events/Tag</div>
                        </div>
                    </div>
                    <div class="advanced-stat">
                        <span class="stat-icon">‚óè</span>
                        <div class="stat-info">
                            <div class="stat-title">Hotspot-Faktor</div>
                            <div class="stat-desc" id="hotspot-factor">Niedrig</div>
                        </div>
                    </div>
                    <div class="advanced-stat">
                        <span class="stat-icon">‚Üó</span>
                        <div class="stat-info">
                            <div class="stat-title">Trend-Score</div>
                            <div class="stat-desc" id="trend-score">+0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar f√ºr neueste Events -->
    <div id="latest-events-sidebar" class="slide-menu">
        <div class="menu-header">
            <h2>Letzte Ereignisse</h2>
            <button class="close-btn" onclick="toggleLatestEventsSidebar()">‚úï</button>
        </div>
        <div id="latest-events-content">
            <p>Keine Ereignisse vorhanden.</p>
        </div>
    </div>
    
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="close-btn" onclick="toggleSidebar()">‚úï</div>
        <h2 id="details">Details zu Ereignissen</h2>
        <div id="event-content">
            <p>W√§hle eine Ereignis aus, um Details zu sehen.</p>
        </div>
    </div>    <!-- Button to Open the Latest Events Sidebar -->
    <button id="latest-events-toggle" onclick="toggleLatestEventsSidebar()">Letzte Ereignisse</button>    <!-- Rectangle Selection Toggle Button -->
    <button id="selection-toggle" onclick="toggleRectangleSelection()">üì¶ Auswahl</button>

    <!-- Hotspot View Controls -->
    <button id="hotspot-exit-button" class="hotspot-exit-button" onclick="exitHotspotView()">‚úï Hotspot-Ansicht beenden</button>
    
    <div id="hotspot-info" class="hotspot-info">
        <h4>Hotspot-Details</h4>
        <div id="hotspot-details-content">
            <div class="hotspot-item">
                <span class="hotspot-label">Anzahl Hotspots:</span>
                <span class="hotspot-value" id="hotspot-total">0</span>
            </div>
            <div class="hotspot-item">
                <span class="hotspot-label">Gr√∂√üter Cluster:</span>
                <span class="hotspot-value" id="largest-cluster">0 Events</span>
            </div>
            <div class="hotspot-item">
                <span class="hotspot-label">Radius:</span>
                <span class="hotspot-value">500m</span>
            </div>
        </div>
    </div>

    <!-- Eigenes JavaScript -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
